{"version":3,"sources":["staged/css-vars.ts","staged/useDragging.ts","staged/useStopDragClick.ts","staged/util.ts","staged/index.tsx","staged/useArrangeAfterResize.ts","staged/usePaging.ts","mocks.ts","App.tsx","index.tsx"],"names":["CssVar","XFactor","_set","name","value","current","style","setProperty","_setX","factor","CENTER","TRANSFORM_X","clientWidth","_transitionOne","ref","xFactor","TRANSITION_DURATION","finish","CssVars","LEFT","RIGHT","trans","Promise","resolve","setTimeout","AMOUNT","String","pageX","e","touches","useDragging","stagedRef","prev","next","stopClick","useRef","useEffect","stopDraggedClick","stopPropagation","addEventListener","removeEventListener","useStopDragClick","lastEnteredX","undefined","draggedX","useCallback","currentX","totalDraggedX","Math","abs","modulo","num","base","Staged","children","amount","hideArrows","autoSlide","noDrag","rearrangeAfterResize","window","useArrangeAfterResize","length","useState","pos","setPos","then","p","usePaging","onEnter","onMove","onLeave","useLayoutEffect","amounts","useMemo","Array","map","_","i","slides","id","setInterval","clearInterval","className","onClick","onMouseDown","onTouchStart","onTouchMove","onMouseMove","onTouchEnd","onMouseUp","articles","authors","title","cover","differentSort","sort","random","ReactDOM","render","a","src","alt","key","draggable","console","log","document","getElementById"],"mappings":"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","file":"static/js/main.0dd95533.chunk.js","sourcesContent":["import { MutableRefObject } from 'react';\n\nexport type StagedRef = MutableRefObject<HTMLDivElement | null>;\nexport const ANIMATION_TIME = 0.5; // in seconds\n\nenum CssVar {\n    TRANSITION_DURATION = '--s-trans-dur',\n    TRANSITION_ANIMATION = '--s-trans-animation',\n    TRANSFORM_X = '--s-transform-x',\n    AMOUNT = '--s-amount',\n}\n\nconst _set = ({ current }: StagedRef, name: CssVar, value: string): void => {\n    if (current) {\n        current.style.setProperty(name, value);\n    }\n};\n\nenum XFactor {\n    LEFT = 0,\n    CENTER = 1,\n    RIGHT = 2,\n}\n\nconst _setX = ({ current }: StagedRef, value: number = 0, factor: XFactor = XFactor.CENTER): void => {\n    if (current) {\n        current.style.setProperty(CssVar.TRANSFORM_X, `${-current.clientWidth * factor + value}px`);\n    }\n};\nconst _transitionOne = (ref: StagedRef, xFactor: XFactor) => {\n    _set(ref, CssVar.TRANSITION_DURATION, `${ANIMATION_TIME}s`);\n    _setX(ref, 0, xFactor);\n};\n\nconst prev = (ref: StagedRef) => _transitionOne(ref, XFactor.LEFT);\nconst center = (ref: StagedRef) => _transitionOne(ref, XFactor.CENTER);\nconst next = (ref: StagedRef) => _transitionOne(ref, XFactor.RIGHT);\nconst update = (ref: StagedRef, value: number) => _setX(ref, value);\nconst amount = (ref: StagedRef, value: number) => _set(ref, CssVar.AMOUNT, String(value));\n\nconst finish = (ref: StagedRef) => {\n    _set(ref, CssVar.TRANSITION_DURATION, '0');\n    _setX(ref, 0, XFactor.CENTER);\n};\n\nconst transition = (ref: StagedRef, trans: (ref: StagedRef) => void): Promise<void> => {\n    trans(ref);\n    return new Promise(resolve => {\n        setTimeout(() => {\n            finish(ref);\n            resolve();\n        }, 1000 * ANIMATION_TIME);\n    });\n};\n\nexport const CssVars = { prev, next, center, finish, update, transition, amount };\n","import { CssVars, StagedRef } from './css-vars';\nimport { MouseEvent, TouchEvent, useCallback, useRef } from 'react';\nimport { useStopDragClick } from './useStopDragClick';\n\nconst DRAG_INTENT_RATE = 0.1; // in [0, 1]\n\ntype TouchOrMouseEvent = TouchEvent<HTMLDivElement> | MouseEvent<HTMLDivElement>;\nconst pageX = (e: TouchOrMouseEvent): number => ('touches' in e ? (e.touches[0] as any).pageX : e.pageX);\n\ntype TouchOrMouseCb = (e: TouchOrMouseEvent) => void;\ntype UseDraggingReturnType = [TouchOrMouseCb, TouchOrMouseCb, TouchOrMouseCb];\n\nexport const useDragging = (\n    ref: StagedRef,\n    stagedRef: StagedRef,\n    prev: () => void,\n    next: () => void\n): UseDraggingReturnType => {\n    const stopClick = useStopDragClick(stagedRef);\n    const lastEnteredX = useRef<number | void>(undefined);\n    const draggedX = useRef<number>(0);\n\n    const onEnter = useCallback(e => {\n        lastEnteredX.current = pageX(e);\n    }, []);\n\n    const onMove = useCallback(e => {\n        const currentX = lastEnteredX.current;\n        if (currentX !== undefined) {\n            draggedX.current = pageX(e) - currentX;\n            CssVars.update(ref, draggedX.current);\n        }\n    }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n    const onLeave = useCallback(() => {\n        const { current } = ref;\n        const currentX = lastEnteredX.current;\n        const totalDraggedX = draggedX.current;\n        if (current && currentX !== undefined) {\n            lastEnteredX.current = undefined;\n            draggedX.current = 0;\n            stopClick.current = !!totalDraggedX;\n            const wasDragIntent = Math.abs(totalDraggedX) / current.clientWidth > DRAG_INTENT_RATE;\n            if (wasDragIntent) {\n                return totalDraggedX < 0 ? next() : prev();\n            }\n            CssVars.transition(ref, CssVars.center);\n        }\n    }, [next, prev, stopClick]); // eslint-disable-line react-hooks/exhaustive-deps\n\n    return [onEnter, onMove, onLeave];\n};\n","import { MutableRefObject, useEffect, useRef } from 'react';\nimport { StagedRef } from './css-vars';\n\nexport const useStopDragClick = (ref: StagedRef): MutableRefObject<boolean> => {\n    const stopClick = useRef<boolean>(false);\n\n    useEffect(() => {\n        const { current } = ref;\n\n        const stopDraggedClick = (e: Event) => {\n            if (stopClick.current) e.stopPropagation();\n        };\n        if (current) {\n            current.addEventListener('click', stopDraggedClick, true);\n            return () => current.removeEventListener('click', stopDraggedClick, true);\n        }\n    }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n    return stopClick;\n};\n","export const modulo = (num: number, base: number) => ((num % base) + base) % base;\n","import React, { ReactNode, useEffect, useLayoutEffect, useMemo, useRef } from 'react';\nimport { useArrangeAfterResize } from './useArrangeAfterResize';\nimport { useDragging } from './useDragging';\nimport { usePaging } from './usePaging';\nimport { modulo } from './util';\nimport { CssVars } from './css-vars';\n\ntype StagedProps = {\n    children: ReactNode[];\n    amount?: number;\n    hideArrows?: boolean;\n    autoSlide?: number;\n    noDrag?: boolean;\n};\n\nexport const Staged: React.FC<StagedProps> = ({ children, amount = 1, hideArrows, autoSlide, noDrag }) => {\n    const ref = useRef<HTMLDivElement | null>(null);\n    const stagedRef = useRef<HTMLDivElement | null>(null);\n    useArrangeAfterResize(ref);\n    const [pos, prev, next] = usePaging(ref, children.length, amount);\n\n    const [onEnter, onMove, onLeave] = useDragging(ref, stagedRef, prev, next);\n\n    useLayoutEffect(() => {\n        CssVars.amount(ref, amount);\n    }, [amount]);\n\n    const amounts = useMemo(() => [...Array(amount * 3)].map((_, i) => i - amount), [amount]);\n    const slides = useMemo(() => amounts.map(i => children[modulo(pos + i, children.length)]), [\n        children,\n        amounts,\n        pos,\n    ]);\n\n    useEffect(() => {\n        if (autoSlide) {\n            const id = setInterval(next, autoSlide);\n            return () => clearInterval(id);\n        }\n    }, [autoSlide, next]);\n\n    return (\n        <div className=\"staged-outer\" ref={ref}>\n            {hideArrows || <div className=\"staged-left-nav\" onClick={prev} />}\n            {noDrag ? (\n                <div className=\"staged\" ref={stagedRef}>\n                    {slides}\n                </div>\n            ) : (\n                <div\n                    className=\"staged\"\n                    ref={stagedRef}\n                    onMouseDown={onEnter}\n                    onTouchStart={onEnter}\n                    onTouchMove={onMove}\n                    onMouseMove={onMove}\n                    onTouchEnd={onLeave}\n                    onMouseUp={onLeave}>\n                    {slides}\n                </div>\n            )}\n            {hideArrows || <div className=\"staged-right-nav\" onClick={next} />}\n        </div>\n    );\n};\n","import { useEffect } from 'react';\nimport { CssVars, StagedRef } from './css-vars';\n\nexport const useArrangeAfterResize = (ref: StagedRef) => {\n    useEffect(() => {\n        const rearrangeAfterResize = () => CssVars.finish(ref);\n        window.addEventListener('resize', rearrangeAfterResize);\n        return () => window.removeEventListener('resize', rearrangeAfterResize);\n    }, []); // eslint-disable-line react-hooks/exhaustive-deps\n};\n","import { useCallback, useState } from 'react';\nimport { CssVars, StagedRef } from './css-vars';\nimport { modulo } from './util';\n\ntype UsePagingReturnType = [number, () => void, () => void];\n\nexport const usePaging = (ref: StagedRef, length: number, amount: number): UsePagingReturnType => {\n    const [pos, setPos] = useState(0);\n\n    const prev = useCallback(() => {\n        CssVars.transition(ref, CssVars.prev).then(() => setPos(p => modulo(p - amount, length)));\n    }, [length]); // eslint-disable-line react-hooks/exhaustive-deps\n\n    const next = useCallback(() => {\n        CssVars.transition(ref, CssVars.next).then(() => setPos(p => modulo(p + amount, length)));\n    }, [length, amount]); // eslint-disable-line react-hooks/exhaustive-deps\n\n    return [pos, prev, next];\n};\n","export const articles = [\n    {\n        authors: 'Charlotte Link',\n        title: 'Die Suche',\n        cover: '/2016/09/10/17/18/book-1659717__340.jpg',\n    },\n    {\n        authors: 'Helen Fields',\n        title: 'Die perfekte Unschuld',\n        cover: '/2014/11/27/10/29/forest-547363__340.jpg',\n    },\n    {\n        authors: 'Carmen Korn',\n        title: 'Zeitenwende',\n        cover: '/2018/09/14/22/57/manhole-cover-3678303__340.jpg',\n    },\n    {\n        authors: 'Julia Kaufhold',\n        title: 'All die schönen Tage',\n        cover: '/2016/11/21/14/12/books-1845614__340.jpg',\n    },\n    {\n        authors: 'Rita Falk',\n        title: 'Eberhofer, Zefix!',\n        cover: '/2015/04/25/03/09/cork-738603__340.jpg',\n    },\n    {\n        authors: 'Andreas Gruber',\n        title: 'Rachewinter',\n        cover: '/2016/05/17/22/16/baby-1399332__340.jpg',\n    },\n    {\n        authors: 'Annette Hess',\n        title: 'Deutsches Haus',\n        cover: '/2017/11/28/22/25/lapland-2984828__340.jpg',\n    },\n    {\n        authors: 'Lori Nelson Spielman',\n        title: 'Heute schon für morgen träumen',\n        cover: '/2015/07/12/14/26/coffee-842020__340.jpg',\n    },\n    {\n        authors: 'Elizabeth George',\n        title: 'Wer Strafe verdient',\n        cover: '/2017/01/06/23/03/sunrise-1959227__340.jpg',\n    },\n    {\n        authors: 'Jussi Adler-Olsen',\n        title: 'Miese kleine Morde',\n        cover: '/2017/05/13/12/40/fashion-2309519__340.jpg',\n    },\n];\n","import React from 'react';\nimport { Staged } from './staged/';\nimport { articles } from './mocks';\n\nconst differentSort = [...articles];\ndifferentSort.sort(() => 0.5 - Math.random());\n\nexport const App: React.FC = () => (\n    <div className=\"App\">\n        <div className=\"top\" />\n        <div className=\"middle\">\n            <Staged amount={3}>\n                {articles.map((a, i) => (\n                    <img\n                        src={`https://cdn.pixabay.com/photo${a.cover}`}\n                        alt={a.title}\n                        key={i}\n                        draggable={false}\n                        onClick={() => console.log('image clicked: ' + a.title)}\n                    />\n                ))}\n            </Staged>\n        </div>\n        <div className=\"bottom\">\n            <Staged hideArrows noDrag autoSlide={3000}>\n                {differentSort.map((a, i) => (\n                    <img\n                        src={`https://cdn.pixabay.com/photo${a.cover}`}\n                        alt={a.title}\n                        key={i}\n                        draggable={false}\n                        onClick={() => console.log('image clicked: ' + a.title)}\n                    />\n                ))}\n            </Staged>\n        </div>\n    </div>\n);\n","import './assets/main.scss';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}