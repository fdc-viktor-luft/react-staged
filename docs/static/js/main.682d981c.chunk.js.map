{"version":3,"sources":["Staged.tsx","mocks.ts","App.tsx","index.tsx"],"names":["CssVar","modulo","num","base","XFactor","_set","name","value","current","style","setProperty","_setX","factor","CENTER","console","log","TRANSFORM_X","clientWidth","_transitionOne","ref","xFactor","TRANSITION_DURATION","transitionPrev","LEFT","transitionNext","RIGHT","finishTransition","transitionAndLogic","trans","logic","setTimeout","pageX","e","touches","Staged","children","useState","pos","setPos","useRef","stagedRef","lastEnteredX","undefined","draggedX","stopClick","length","onPrev","useCallback","p","onNext","onEnter","onMove","currentX","onLeave","totalDraggedX","Math","abs","useEffect","stopDraggedClick","stopPropagation","addEventListener","removeEventListener","rearrangeAfterResize","window","className","onClick","onMouseDown","onTouchStart","onTouchMove","onMouseMove","onTouchEnd","onMouseUp","articles","authors","title","cover","differentSort","sort","random","ReactDOM","render","map","a","i","src","alt","key","draggable","document","getElementById"],"mappings":"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","file":"static/js/main.682d981c.chunk.js","sourcesContent":["import React, {\n    MouseEvent,\n    MutableRefObject,\n    ReactNode,\n    TouchEvent,\n    useCallback,\n    useEffect,\n    useRef,\n    useState,\n} from 'react';\n\ntype StagedProps = { children: ReactNode[] };\ntype StagedRef = MutableRefObject<HTMLDivElement | null>;\n\nconst modulo = (num: number, base: number) => ((num % base) + base) % base;\n\nconst ANIMATION_TIME = 0.5; // in seconds\nconst DRAG_INTENT_RATE = 0.1; // in [0, 1]\n\nenum CssVar {\n    TRANSITION_DURATION = '--s-trans-dur',\n    TRANSITION_ANIMATION = '--s-trans-animation',\n    TRANSFORM_X = '--s-transform-x',\n}\n\nconst _set = ({ current }: StagedRef, name: CssVar, value: string): void => {\n    if (current) {\n        current.style.setProperty(name, value);\n    }\n};\n\nenum XFactor {\n    LEFT = 0,\n    CENTER = 1,\n    RIGHT = 2,\n}\n\nconst _setX = ({ current }: StagedRef, value: number = 0, factor: XFactor = XFactor.CENTER): void => {\n    if (current) {\n        console.log();\n        current.style.setProperty(CssVar.TRANSFORM_X, `${-current.clientWidth * factor + value}px`);\n    }\n};\nconst _transitionOne = (ref: StagedRef, xFactor: XFactor) => {\n    _set(ref, CssVar.TRANSITION_DURATION, `${ANIMATION_TIME}s`);\n    _setX(ref, 0, xFactor);\n};\n\nconst transitionPrev = (ref: StagedRef) => _transitionOne(ref, XFactor.LEFT);\nconst transitionNext = (ref: StagedRef) => _transitionOne(ref, XFactor.RIGHT);\n\nconst finishTransition = (ref: StagedRef) => {\n    _set(ref, CssVar.TRANSITION_DURATION, '0');\n    _setX(ref, 0, XFactor.CENTER);\n};\n\nconst transitionAndLogic = (ref: StagedRef, trans: (ref: StagedRef) => void, logic: () => void): void => {\n    trans(ref);\n    setTimeout(() => {\n        finishTransition(ref);\n        logic();\n    }, 1000 * ANIMATION_TIME);\n};\n\nconst pageX = (e: TouchEvent<HTMLDivElement> | MouseEvent<HTMLDivElement>): number =>\n    'touches' in e ? (e.touches[0] as any).pageX : e.pageX;\n\nexport const Staged: React.FC<StagedProps> = ({ children }) => {\n    const [pos, setPos] = useState(0);\n    const ref = useRef<HTMLDivElement | null>(null);\n    const stagedRef = useRef<HTMLDivElement | null>(null);\n    const lastEnteredX = useRef<number | void>(undefined);\n    const draggedX = useRef<number>(0);\n    const stopClick = useRef<boolean>(false);\n\n    const length = children.length;\n\n    const onPrev = useCallback(() => {\n        transitionAndLogic(ref, transitionPrev, () => setPos(p => (p === 0 ? length - 1 : p - 1)));\n    }, [length]);\n\n    const onNext = useCallback(() => {\n        transitionAndLogic(ref, transitionNext, () => setPos(p => (p === length - 1 ? 0 : p + 1)));\n    }, [length]);\n\n    const onEnter = useCallback(e => {\n        lastEnteredX.current = pageX(e);\n    }, []);\n\n    const onMove = useCallback(e => {\n        const currentX = lastEnteredX.current;\n        if (currentX !== undefined) {\n            draggedX.current = pageX(e) - currentX;\n            _setX(ref, draggedX.current);\n        }\n    }, []);\n\n    const onLeave = useCallback(() => {\n        const { current } = ref;\n        const currentX = lastEnteredX.current;\n        const totalDraggedX = draggedX.current;\n        if (current && currentX !== undefined) {\n            lastEnteredX.current = undefined;\n            draggedX.current = 0;\n            stopClick.current = !!totalDraggedX;\n            const wasDragIntent = Math.abs(totalDraggedX) / current.clientWidth > DRAG_INTENT_RATE;\n            if (wasDragIntent) {\n                return totalDraggedX < 0 ? onNext() : onPrev();\n            }\n            transitionAndLogic(ref, () => _transitionOne(ref, XFactor.CENTER), () => {});\n        }\n    }, [onNext, onPrev]);\n\n    useEffect(() => {\n        const { current } = stagedRef;\n        const stopDraggedClick = (e: Event) => {\n            if (stopClick.current) e.stopPropagation();\n        };\n        if (current) {\n            current.addEventListener('click', stopDraggedClick, true);\n            return () => current.removeEventListener('click', stopDraggedClick, true);\n        }\n    }, []);\n\n    useEffect(() => {\n        const rearrangeAfterResize = () => finishTransition(ref);\n        window.addEventListener('resize', rearrangeAfterResize);\n        return () => window.removeEventListener('resize', rearrangeAfterResize);\n    }, []);\n\n    return (\n        <div className=\"staged-outer\" ref={ref}>\n            <div className=\"staged-left-nav\" onClick={onPrev} />\n            <div\n                className=\"staged\"\n                ref={stagedRef}\n                onMouseDown={onEnter}\n                onTouchStart={onEnter}\n                onTouchMove={onMove}\n                onMouseMove={onMove}\n                onTouchEnd={onLeave}\n                onMouseUp={onLeave}>\n                {children[modulo(pos - 1, length)]}\n                {children[pos]}\n                {children[modulo(pos + 1, length)]}\n            </div>\n            <div className=\"staged-right-nav\" onClick={onNext} />\n        </div>\n    );\n};\n","export const articles = [\n    {\n        authors: 'Charlotte Link',\n        title: 'Die Suche',\n        cover: '/2016/09/10/17/18/book-1659717__340.jpg',\n    },\n    {\n        authors: 'Helen Fields',\n        title: 'Die perfekte Unschuld',\n        cover: '/2014/11/27/10/29/forest-547363__340.jpg',\n    },\n    {\n        authors: 'Carmen Korn',\n        title: 'Zeitenwende',\n        cover: '/2018/09/14/22/57/manhole-cover-3678303__340.jpg',\n    },\n    {\n        authors: 'Julia Kaufhold',\n        title: 'All die schönen Tage',\n        cover: '/2016/11/21/14/12/books-1845614__340.jpg',\n    },\n    {\n        authors: 'Rita Falk',\n        title: 'Eberhofer, Zefix!',\n        cover: '/2015/04/25/03/09/cork-738603__340.jpg',\n    },\n    {\n        authors: 'Andreas Gruber',\n        title: 'Rachewinter',\n        cover: '/2016/05/17/22/16/baby-1399332__340.jpg',\n    },\n    {\n        authors: 'Annette Hess',\n        title: 'Deutsches Haus',\n        cover: '/2017/11/28/22/25/lapland-2984828__340.jpg',\n    },\n    {\n        authors: 'Lori Nelson Spielman',\n        title: 'Heute schon für morgen träumen',\n        cover: '/2015/07/12/14/26/coffee-842020__340.jpg',\n    },\n    {\n        authors: 'Elizabeth George',\n        title: 'Wer Strafe verdient',\n        cover: '/2017/01/06/23/03/sunrise-1959227__340.jpg',\n    },\n    {\n        authors: 'Jussi Adler-Olsen',\n        title: 'Miese kleine Morde',\n        cover: '/2017/05/13/12/40/fashion-2309519__340.jpg',\n    },\n];\n","import React from 'react';\nimport { Staged } from './Staged';\nimport { articles } from './mocks';\n\nconst differentSort = [...articles];\ndifferentSort.sort(() => 0.5 - Math.random());\n\nexport const App: React.FC = () => (\n    <div className=\"App\">\n        <div className=\"top\" />\n        <div className=\"middle\">\n            <Staged>\n                {articles.map((a, i) => (\n                    <img\n                        src={`https://cdn.pixabay.com/photo${a.cover}`}\n                        alt={a.title}\n                        key={i}\n                        draggable={false}\n                        onClick={() => console.log('image clicked: ' + a.title)}\n                    />\n                ))}\n            </Staged>\n        </div>\n        <div className=\"bottom\">\n            <Staged>\n                {differentSort.map((a, i) => (\n                    <img\n                        src={`https://cdn.pixabay.com/photo${a.cover}`}\n                        alt={a.title}\n                        key={i}\n                        draggable={false}\n                        onClick={() => console.log('image clicked: ' + a.title)}\n                    />\n                ))}\n            </Staged>\n        </div>\n    </div>\n);\n","import './assets/main.scss';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}